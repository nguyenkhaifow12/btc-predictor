<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>D·ª± ƒëo√°n BTC v·ªõi ƒêa ch·ªâ b√°o</title>

  <!-- Chart.js ƒë·ªÉ v·∫Ω bi·ªÉu ƒë·ªì n·∫øu c·∫ßn -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ‚úÖ D√πng b·∫£n ·ªïn ƒë·ªãnh c√≥ technicalindicators tr√™n window -->
  <script src="https://cdn.jsdelivr.net/npm/technicalindicators@2.0.16/dist/browser.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h2 { color: #333; }
    button {
      margin-top: 20px;
      padding: 10px 15px;
      background: #008080;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
    }
    .result {
      margin-top: 30px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    ul { padding-left: 20px; }
  </style>
</head>
<body>
  <h2>D·ª± ƒëo√°n BTC - K·∫øt h·ª£p ƒëa ch·ªâ b√°o</h2>
  <button onclick="fetchDataAndPredict()">üì° L·∫•y d·ªØ li·ªáu & D·ª± ƒëo√°n ngay</button>

  <div id="result" class="result"></div>

  <script>
    async function fetchDataAndPredict() {
      try {
        const technicalindicators = window.technicalindicators;

        const [priceRes, fundingRes, oiRes] = await Promise.all([
          fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT'),
          fetch('https://fapi.binance.com/fapi/v1/fundingRate?symbol=BTCUSDT&limit=1'),
          fetch('https://fapi.binance.com/fapi/v1/openInterest?symbol=BTCUSDT')
        ]);

        const price = parseFloat((await priceRes.json()).price);
        const fundingRate = parseFloat((await fundingRes.json())[0].fundingRate);
        const openInterest = parseFloat((await oiRes.json()).openInterest);

        // D·ªØ li·ªáu gi·∫£ l·∫≠p g·∫ßn gi·ªëng th·ª±c t·∫ø
        const closePrices = Array.from({length: 200}, () => price * (1 + (Math.random() - 0.5) * 0.02));

        const ema20 = technicalindicators.EMA.calculate({period: 20, values: closePrices});
        const ema50 = technicalindicators.EMA.calculate({period: 50, values: closePrices});
        const ema200 = technicalindicators.EMA.calculate({period: 200, values: closePrices});

        const macd = technicalindicators.MACD.calculate({
          values: closePrices,
          fastPeriod: 12,
          slowPeriod: 26,
          signalPeriod: 9,
          SimpleMAOscillator: false,
          SimpleMASignal: false
        });

        const rsi = technicalindicators.RSI.calculate({period: 14, values: closePrices});
        const adx = technicalindicators.ADX.calculate({
          close: closePrices,
          high: closePrices.map(p => p * 1.01),
          low: closePrices.map(p => p * 0.99),
          period: 14
        });

        const ema20Val = ema20.at(-1);
        const ema50Val = ema50.at(-1);
        const ema200Val = ema200.at(-1);
        const macdVal = macd.at(-1)?.MACD;
        const macdSignal = macd.at(-1)?.signal;
        const rsiVal = rsi.at(-1);
        const adxVal = adx.at(-1)?.adx;
        const plusDI = adx.at(-1)?.pdi;
        const minusDI = adx.at(-1)?.mdi;

        const volume = 1000 + Math.random() * 200; // gi·∫£ l·∫≠p
        const avgVolume = 950;
        const oiVolume = 1200;
        const outflow = 1100;
        const candle = 'bullish';

        let signals = [];

        if (ema20Val > ema50Val && ema50Val > ema200Val)
          signals.push("‚úÖ EMA20 > EMA50 > EMA200");
        if (macdVal > macdSignal)
          signals.push("‚úÖ MACD > Signal");
        if (rsiVal > 55 && rsiVal < 70)
          signals.push("‚úÖ RSI > 55 v√† < 70");
        if (adxVal > 25 && plusDI > minusDI)
          signals.push("‚úÖ ADX > 25 v√† +DI > -DI");
        if (volume > avgVolume)
          signals.push("‚úÖ Volume cao h∆°n trung b√¨nh");
        if (fundingRate < 0)
          signals.push("‚úÖ Funding Rate < 0 ‚Üí d·ªÖ ƒë·∫£o chi·ªÅu tƒÉng");
        if (openInterest > 0 && oiVolume > avgVolume)
          signals.push("‚úÖ OI v√† Volume tƒÉng m·∫°nh ‚Üí x√°c nh·∫≠n trend");
        if (outflow > 1000)
          signals.push("‚úÖ BTC r√∫t kh·ªèi s√†n nhi·ªÅu ‚Üí t√≠n hi·ªáu t√≠ch tr·ªØ");
        if (candle === "bullish")
          signals.push("‚úÖ M√¥ h√¨nh n·∫øn tƒÉng g·∫ßn ƒë√¢y");

        const finalSignal = signals.length >= 6
          ? "üìà T√≠n hi·ªáu m·∫°nh: C√≥ th·ªÉ mua th·ª≠ v·ªõi v·ªã th·∫ø nh·ªè"
          : signals.length >= 3
            ? "üìä T√≠n hi·ªáu trung l·∫≠p: Theo d√µi th√™m"
            : "‚ö†Ô∏è T√≠n hi·ªáu y·∫øu ho·∫∑c kh√¥ng r√µ r√†ng: Ch·ªù th√™m";

        document.getElementById('result').innerHTML =
          `<h3>K·∫øt qu·∫£ d·ª± ƒëo√°n:</h3><ul><li>${signals.join('</li><li>')}</li></ul><p><strong>${finalSignal}</strong></p>`;
      } catch (error) {
        document.getElementById('result').innerHTML = `<p style="color:red">‚ùå L·ªói khi l·∫•y d·ªØ li·ªáu ho·∫∑c t√≠nh to√°n: ${error}</p>`;
        console.error(error);
      }
    }
  </script>
</body>
</html>
